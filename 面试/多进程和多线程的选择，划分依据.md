## 一.进程&线程

1.进程是资源分配的基本单位。
2.线程是独立调度的基本单位。
>注意：
>（1）线程中存在一些必不可少的资源（程序计数器、一组寄存器和栈）
>（2）一个进程拥有多个线程。
>（3）处于同一个进程中的线程可以共享进程中的资源。


## 区别：

**1.拥有资源**
进程是资源分配的基本单位，线程基本不拥有资源，但是线程可以访问隶属于进程中的资源。
**2.调度**
线程是独立调度的基本单位，在同一进程中，线程的切换不会引起进程的切换，只有一个进程中的线程切换到另一个进程中的线程才会引起进程的切换。一个进程的崩溃后，在保护模式下不会影响其他进程。而线程只是一个进程中的不同执行路径，一个线程崩溃相当于整个进程崩溃。
**3.系统开销**
创建和撤销进程时，系统需要为进程分配资源或回收资源，所付出的开销大于创建和撤销线程的开销。除此外，进程的切换涉及当前进程CPU环境的保存以及新进程环境的设置，线程的切换只需要保存少量寄存器内容，开销小。
**4.通信**
线程们可以通过直接读写同一进程中的数据进行通信，但是进程需要接触IPC。

## 二、IPC（进程通信）的方式
1.管道
> 半双工通信，只能单项流动
> 只能在父子进程中使用

2.命名管道（FIFO）

> 半双工通信
> 可以再不相关的进程和不同计算机之间使用

3.信号

> 是一种比较复杂的通信方式，用于接收进程某一事件已经发生。

4.信号量

> 控制多个进程对资源区的访问，作为一种锁机制，防止不同进程同时访问某一共享资源。
> 作为进程间或同一进程内不同线程间的同步手段。

5.消息队列

> 消息队列可以独立于读写进程存在，避免了FIFO（命名管道）中同步管道的打开和关闭是可能产生的困难。
> 避免了FIFO的同步阻塞问题，不需要进程自己去提供同步方法。
> 可以根据消息类型有选择地接收消息，FIFO是只能默认接收。

6.共享内存

> 映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问
> **共享内存是最快的IPC方式。**
> 往往与其他通信机制，如信号量等配合使用，来实现进程间的同步和通信。

7.套接字

> 与其他通信机制不同的是，它可用于不同机器间的进程通信。

## 三、多进程和多线程的选择，划分依据

参考自：https://blog.csdn.net/ligupeng7929/article/details/91865394

| 对比           | 进程                                                         | 线程                                 | 总结     |
| :------------- | :----------------------------------------------------------- | ------------------------------------ | -------- |
| 数据共享、同步 | 数据共享复杂（需要IPC）；数据是分开的，同步简单              | 共享进程数据，数据共享简单，同步复杂 | 各有优势 |
| 内存、CPU      | 拥有资源、占用内存多，CPU利用率低                            | 占用内存少、切换简单、CPU利用率高    | 线程优势 |
| 创建销毁、切换 | 复杂、速度慢                                                 | 简单、速度快                         | 线程优势 |
| 编程、调试     | 编程简单、调试简单                                           | 编程复杂、调试复杂                   | 进程优势 |
| 可靠性         | 进程间不会相互影响                                           | 一个线程挂掉会导致整个进程挂掉       | 进程优势 |
| 分布式         | 适应于多核，多机分布式；如果一台机器不够，扩展到多台机器比较简单 | 适应于多核分布式                     | 进程优势 |

#### 1.需要频繁创建、销毁、切换的优先使用线程

（Web服务器，来一个连接建立一个线程，断了就销毁线程）

#### 2.需要进行大量计算的优先使用线程

消耗CPU，切换频繁，例如：图像处理、算法处理

#### 3.强相关的处理用线程，弱相关的处理用进程

什么叫强相关、弱相关？理论上很难定义，给个简单的例子就明白了。

一般的Server需要完成如下任务：消息收发、消息处理。“消息收发”和“消息处理”就是弱相关的任务，而“消息处理”里面可能又分为“消息解码”、“业务处理”，这两个任务相对来说相关性就要强多了。因此“消息收发”和“消息处理”可以分进程设计，“消息解码”、“业务处理”可以分线程设计。

当然这种划分方式不是一成不变的，也可以根据实际情况进行调整。

#### 4.可能要扩展到多机分布的用进程，多核分布用线程

#### 5.都满足需求的情况下，选用最熟悉，最拿手的方式

至于“数据共享、同步”、“编程、调试”、“可靠性”这几个维度的所谓的“复杂、简单”应该怎么取舍，我只能说：没有明确的选择方法。但我可以告诉你一个选择原则：如果多进程和多线程都能够满足要求，那么选择你最熟悉、最拿手的那个。 

需要提醒的是：虽然我给了这么多的选择原则，但实际应用中基本上都是“进程+线程”的结合方式，千万不要真的陷入一种非此即彼的误区。

**消耗资源：**

从内核的观点看，进程的目的就是担当分配系统资源（CPU时间、内存等）的基本单位。线程是进程的一个执行流，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位。

线程，它们彼此之间使用相同的地址空间，共享大部分数据，启动一个线程所花费的空间远远**小于**启动一个进程所花费的空间，而且，线程间彼此切换所需的时间也远远小于进程间切换所需要的时间。据统计，总的说来，一个进程的开销大约是一个线程开销的**30倍左右**，当然，在具体的系统上，这个数据可能会有较大的区别。

**通讯方式：**

进程之间传递数据只能是通过通讯的方式，即费时又不方便。线程时间数据大部分共享（线程函数内部不共享），快捷方便。但是数据同步需要锁，对于static变量尤其注意

**线程自身优势：**

提高应用程序响应；使多CPU系统更加有效。操作系统会保证当线程数不大于CPU数目时，不同的线程运行于不同的CPU上；

改善程序结构。一个既长又复杂的进程可以考虑分为多个线程，成为几个独立或半独立的运行部分，这样的程序会利于理解和修改。